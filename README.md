# Chat 4004

### A simple messaging application written in Flask

## Tools
- Language: Python for backend, JavaScript for frontend
- Backend: Flask
- Database: SQLite (via SQLAlchemy Python binding)
- Frontend: Vanilla HTML, JS, CSS
- Third Party API: Discord (via py-cord Python binding)
- Others
  - Passlib for secure password hashing and salting
  - Pillow for resizing and re-encoding the profile pictures
  - Socket.io for communication between the frontend and backend and for communication between the backend and Discord bot

![Screenshot of two users chatting using the app, one with the default turtle avatar and one with a avatar depicting the character Hatsune Miku. You can tell by the timestamps on the messages that this screenshot was taken at 2am.](https://github.com/user-attachments/assets/4de327d4-a71d-4ad3-a79a-d17810e2b1b3)


## Features

### Secure login system using passlib
![Screenshot showing the login and create new account pages](https://github.com/user-attachments/assets/97d630a8-54be-43b3-8145-60ed6be903d7)
This contains validation and passwords are never stored in plain text, instead using a sha_256 hashed string with a [salt](https://en.wikipedia.org/wiki/Salt_(cryptography)). If two users have the same password, they will be recorded in the database differently because of the salt.

### Multiple rooms
![Screenshot of the room select page](https://github.com/user-attachments/assets/7623286c-d5cf-4dff-94a7-84fc5bcf6961)
Before joining the chat, the user is prompted to type in the name of a room. This allows for different chats to be going on simultaneously

### User Settings
![Screenshot of the Update Profile page](https://github.com/user-attachments/assets/d15323ac-9dbb-44e5-82f9-bee97c35cf98)
Users can change their display name and profile picture after creating an account

### Discord Integration
![Screenshot of two users chatting, one on Discord and one on the web app](https://github.com/user-attachments/assets/491b5592-9474-4670-ad07-55ceaa662897)
Users of the Discord messaging app can add a bot user who can bind a Discord channel and a room in this web app together. This allows users of both services to communicate (almost) seamlessly

## Setup

### General Setup

This has been tested with Python 3.12, newer and older versions of Python may or may not work.

Install the following Python modules:

`pip install flask flask-socketio flask-sqlalchemy passlib pillow dotenv`

(if pip is not in your PATH, replace with `python -m pip`)

create an .env file with the line:

`SECRET_KEY = d7bd13851de1259cfea3ab001c82f9f100fd1cad967312dd`

replacing the token with a secure, random generated secret key

can be generated by using a Python REPL and typing in the following

```Python
>>> from secrets import token_hex
>>> token_hex(24)
'd9ca5eb974351707b3b0d2cb00a72aa5900498e167870dba'
```

start the server in Debug mode using:

`flask --app main --debug run --host=0.0.0.0`

(if flask is not in your PATH, replace with `python -m flask`)

## Discord Setup

If you want Discord integration, create a Discord account, then follow [this tutorial](https://guide.pycord.dev/getting-started/creating-your-first-bot) until you reach the section "Protecting Tokens"

In the Bot section of the developer, check off the "Message Content Intent" field, this is necessary for the bot to read messages send on Discord's end.

When Creating the OAuth link to invite the bot to the server add the bot scope and the following permissions

![image](https://github.com/user-attachments/assets/2f8d7bd7-2bc5-4aff-b513-92fc0363ece0)

Add the line: `DISCORD_TOKEN = NzkyNzE1NDU0MTk2MDg4ODQy.X-hvzA.Ovy4MCQywSkoMRRclStW4xAYK7I` to your .env file replacing the token with the one you copied from the developer portal

Install the following Python modules:

`pip install py-cord "python-socketio[asyncio_client]"`

Run the Discord bot with
`python discordbot.py`

Use the generate OAuth link to invite the bot into a Discord server (What Discord calls group chats with multiple channels, not an actual server)

run the command through the Discord chat interface `/bindchannel [roomname]` with [roomname] being replaced with a valid room created in the web app

## ChatGPT logs
I mostly coded this by hand with some short snipets from documentation sources, the textbook, and stack overflow, however I did use ChatGPT to answer some simple questions and generate some code snipets.
- https://chatgpt.com/share/68073c1b-d168-8008-b317-b5a10a7abc05
- https://chatgpt.com/share/68073c3d-bd8c-8008-92ed-cc5365e5c30c
- https://chatgpt.com/share/68073c0b-6204-8008-84b0-d4889e10b769
